# Fake RTC
[Тестовое задание для компании Syntacore](https://syntacore.com/media/files/trial_task_sw.pdf)

Модуль ядра Linux, имитирующий часы с неравномерным подсчётом времени

Модуль разработан для **версии ядра 5.4**. Тестировался на Ubuntu 18.04. Работа на других версиях ядра не гарантируется

## Установка и запуск
В системе должен быть установлен компилятор gcc и система сборки make

1. Склонировать этот репозиторий
2. Из корня репозитория выполнить команду `make`
3. Для автоматической установки и тестирвоаня выполнить `sudo bash test/demo.sh`
Для ручной установки выполнить `sudo insmod fake_rtc.ko`

В каталоге `/proc` создастся файл `FakeRTC`. При чтении из него будут выведены доступные режимы и текущий режим.

По умолчанию модуль запускается в реальном режиме. Для изменения режима нужно выполнить

`echo "{номер режима}" > /proc/FakeRTC`

## Алгоритм работы 
Модуль хранит синхронизированное реальное время в наносекундах от 1 Января 1970. Оно записывается при инициализации модуля и при установке на него времени. Тогда же сохраняется время с момента запуска системы в наносекундах. 

При чтении с модуля он запрашивает у системы время с момента запуска и вычитает из него сохранённое время с запуска. Таким образом модуль вычисляет, сколько наносекунд прошло с синхронизации реального времени. Это значение:

- умножается на ускоряющий коэффициент в ускоренном режиме
- делится на замедляющий коэффициент в замедленном режиме
- умножается на случайно генерируемый коэффициент в случайном режиме
- остаётся без изменений в реальном режиме

Полученное значение прибавляется к синхронизированному реальному времени